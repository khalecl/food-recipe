<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Meal Planner</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2196F3;
            --primary-dark: #1976D2;
            --secondary-color: #FFC107;
            --background-color: #f5f5f5;
            --surface-color: #ffffff;
            --text-primary: #212121;
            --text-secondary: #757575;
            --border-color: #e0e0e0;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --error-color: #f44336;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 50px rgba(0,0,0,0.2);
            --transition-fast: all 0.15s ease;
            --transition-normal: all 0.3s ease;
            --transition-slow: all 0.5s ease;
        }

        [data-theme="dark"] {
            --primary-color: #64B5F6;
            --primary-dark: #42A5F5;
            --secondary-color: #FFD54F;
            --background-color: #121212;
            --surface-color: #1e1e1e;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border-color: #333333;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.25);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.35);
            --shadow-xl: 0 20px 50px rgba(0,0,0,0.5);
        }

        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            transition: var(--transition-slow);
            line-height: 1.6;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 1rem;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: var(--transition-normal);
            transform: translateY(0);
        }

        .app-header.hidden {
            transform: translateY(-100%);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .app-title i {
            transition: var(--transition-fast);
        }

        .app-title:hover i {
            transform: rotate(15deg) scale(1.1);
        }

        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition-normal);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        .main-content {
            flex: 1;
            padding: 1rem;
        }

        .screen {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: var(--transition-normal);
        }

        .screen.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .week-container {
            background: var(--surface-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-lg);
            transition: var(--transition-normal);
        }

        .week-container:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-2px);
        }

        .week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .week-navigation {
            display: flex;
            gap: 0.5rem;
        }

        .nav-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-sm);
        }

        .nav-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .nav-btn:active {
            transform: translateY(1px);
            box-shadow: var(--shadow-sm);
        }

        .nav-btn i {
            transition: var(--transition-fast);
        }

        .nav-btn:hover i:first-child {
            transform: translateX(-2px);
        }

        .nav-btn:hover i:last-child {
            transform: translateX(2px);
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .day-card {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .day-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .day-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-color);
            transition: var(--transition-normal);
        }

        .day-card:hover::before {
            width: 6px;
            background: var(--secondary-color);
        }

        .day-header {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary-color);
            text-align: center;
            font-size: 1.1rem;
            position: relative;
            padding-bottom: 0.5rem;
        }

        .day-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 2px;
            background: var(--primary-color);
            transition: var(--transition-normal);
        }

        .day-card:hover .day-header::after {
            width: 80px;
            background: var(--secondary-color);
        }

        .meals-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .meal-slot {
            background: var(--background-color);
            border: 2px dashed var(--border-color);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-normal);
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .meal-slot:hover {
            border-color: var(--primary-color);
            background: rgba(33, 150, 243, 0.05);
            transform: scale(1.02);
        }

        .meal-slot.filled {
            background: var(--primary-color);
            color: white;
            border-style: solid;
            border-color: transparent;
            box-shadow: var(--shadow-sm);
        }

        .meal-slot.filled:hover {
            background: var(--primary-dark);
            transform: scale(1.02);
        }

        .meal-type {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 0.25rem;
            transition: var(--transition-fast);
        }

        .meal-slot:hover .meal-type {
            opacity: 1;
            transform: translateY(-2px);
        }

        .meal-name {
            font-weight: 500;
            transition: var(--transition-fast);
        }

        .meal-slot:hover .meal-name {
            transform: scale(1.05);
        }

        .meal-cost {
            font-size: 0.8rem;
            margin-top: 0.25rem;
            transition: var(--transition-fast);
        }

        .meal-slot:hover .meal-cost {
            transform: translateY(2px);
        }

        .cost-widget {
            background: linear-gradient(135deg, var(--success-color), #45a049);
            color: white;
            padding: 1.5rem;
            border-radius: 16px;
            text-align: center;
            margin-top: 1.5rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .cost-widget::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
            transform: rotate(0deg);
            transition: var(--transition-slow);
            opacity: 0;
        }

        .cost-widget:hover::before {
            opacity: 1;
            transform: rotate(180deg);
        }

        .cost-widget:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .cost-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .cost-item {
            text-align: center;
            transition: var(--transition-normal);
        }

        .cost-item:hover {
            transform: scale(1.05);
        }

        .cost-label {
            font-size: 0.8rem;
            opacity: 0.9;
            margin-bottom: 0.25rem;
            transition: var(--transition-fast);
        }

        .cost-item:hover .cost-label {
            transform: translateY(-2px);
        }

        .cost-value {
            font-size: 1.4rem;
            font-weight: 600;
            transition: var(--transition-fast);
        }

        .cost-item:hover .cost-value {
            transform: scale(1.1);
            color: var(--secondary-color);
        }

        .meals-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .search-filter-container {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--surface-color);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            transition: var(--transition-normal);
            box-shadow: var(--shadow-sm);
            min-width: 250px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.2);
            transform: translateY(-1px);
        }

        .filter-tags {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .filter-tag {
            background: var(--background-color);
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition-normal);
            font-size: 0.8rem;
            box-shadow: var(--shadow-sm);
        }

        .filter-tag:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .filter-tag.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .filter-tag:active {
            transform: translateY(1px);
            box-shadow: var(--shadow-sm);
        }

        .meals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .meal-card {
            background: var(--surface-color);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition-normal);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
            transform: perspective(1000px);
        }

        .meal-card:hover {
            transform: translateY(-5px) perspective(1000px) rotateX(2deg) rotateY(2deg);
            box-shadow: var(--shadow-xl);
        }

        .meal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transform: scaleX(0);
            transform-origin: left;
            transition: var(--transition-normal);
        }

        .meal-card:hover::before {
            transform: scaleX(1);
        }

        .meal-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .meal-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            transition: var(--transition-fast);
        }

        .meal-card:hover .meal-title {
            color: var(--primary-color);
            transform: translateX(3px);
        }

        .favorite-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition-normal);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .favorite-btn:hover {
            background: rgba(244, 67, 54, 0.1);
            color: var(--error-color);
            transform: scale(1.2);
        }

        .favorite-btn.active {
            color: var(--error-color);
            animation: heartBeat 0.8s ease;
        }

        .favorite-btn:active {
            transform: scale(0.9);
        }

        .meal-tags {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
        }

        .meal-tag {
            background: var(--secondary-color);
            color: #333;
            padding: 0.3rem 0.75rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 500;
            transition: var(--transition-fast);
            box-shadow: var(--shadow-sm);
        }

        .meal-card:hover .meal-tag {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .meal-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
            transition: var(--transition-fast);
        }

        .meal-card:hover .meal-info {
            color: var(--text-primary);
        }

        .meal-info span {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            transition: var(--transition-fast);
        }

        .meal-card:hover .meal-info span {
            transform: translateX(3px);
        }

        .meal-ingredients {
            margin-top: 0.75rem;
            transition: var(--transition-fast);
        }

        .meal-card:hover .meal-ingredients {
            transform: translateY(3px);
        }

        .ingredients-header {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            transition: var(--transition-fast);
        }

        .meal-card:hover .ingredients-header {
            color: var(--primary-color);
        }

        .ingredients-list {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.6;
            transition: var(--transition-fast);
        }

        .meal-card:hover .ingredients-list {
            color: var(--text-primary);
        }

        .settings-section {
            background: var(--surface-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition-normal);
        }

        .settings-section:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .settings-title {
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .settings-title i {
            transition: var(--transition-fast);
        }

        .settings-section:hover .settings-title i {
            transform: rotate(15deg);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition-fast);
        }

        .setting-item:hover {
            transform: translateX(5px);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-weight: 500;
            transition: var(--transition-fast);
        }

        .setting-item:hover .setting-label {
            color: var(--primary-color);
        }

        .setting-description {
            font-size: 0.8rem;
            color: var(--text-secondary);
            transition: var(--transition-fast);
        }

        .setting-item:hover .setting-description {
            color: var(--text-primary);
        }

        .setting-control select {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--surface-color);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            transition: var(--transition-normal);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
        }

        .setting-control select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.2);
        }

        .bottom-nav {
            background: var(--surface-color);
            border-top: 1px solid var(--border-color);
            padding: 0.5rem;
            display: flex;
            justify-content: space-around;
            position: sticky;
            bottom: 0;
            z-index: 100;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            transition: var(--transition-normal);
        }

        [data-theme="dark"] .bottom-nav {
            box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            cursor: pointer;
            transition: var(--transition-normal);
            border-radius: 8px;
            flex: 1;
            max-width: 80px;
            position: relative;
        }

        .nav-item:hover {
            background: var(--background-color);
            transform: translateY(-3px);
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: var(--primary-color);
            border-radius: 3px;
            transition: var(--transition-normal);
        }

        .nav-item:hover::after {
            width: 40px;
        }

        .nav-icon {
            font-size: 1.4rem;
            margin-bottom: 0.25rem;
            transition: var(--transition-fast);
        }

        .nav-item:hover .nav-icon {
            transform: scale(1.2);
        }

        .nav-label {
            font-size: 0.7rem;
            font-weight: 500;
            transition: var(--transition-fast);
        }

        .nav-item:hover .nav-label {
            transform: translateY(2px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            backdrop-filter: blur(8px);
            opacity: 0;
            transition: var(--transition-normal);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
        }

        .modal-content {
            background: var(--surface-color);
            border-radius: 20px;
            padding: 2rem;
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: var(--shadow-xl);
            transform: scale(0.9);
            transition: var(--transition-normal);
            opacity: 0;
        }

        .modal.active .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-weight: 600;
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition-normal);
        }

        .close-btn:hover {
            color: var(--error-color);
            transform: rotate(90deg) scale(1.1);
            background: rgba(244, 67, 54, 0.1);
        }

        .close-btn:active {
            transform: rotate(90deg) scale(0.9);
        }

        .alternatives-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .alternatives-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .alternative-item {
            background: var(--background-color);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
            transition: var(--transition-normal);
            box-shadow: var(--shadow-sm);
        }

        .alternative-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-md);
        }

        .alternative-item strong {
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .days-grid {
                grid-template-columns: 1fr;
            }
            
            .search-filter-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .meals-grid {
                grid-template-columns: 1fr;
            }
            
            .cost-breakdown {
                grid-template-columns: repeat(2, 1fr);
            }

            .week-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .week-navigation {
                width: 100%;
                justify-content: space-between;
            }

            .nav-btn {
                flex: 1;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 0.75rem;
            }
            
            .modal-content {
                margin: 1rem;
                padding: 1.5rem;
                border-radius: 16px;
            }

            .app-title {
                font-size: 1.2rem;
            }

            .day-card {
                padding: 1rem;
            }

            .meal-card {
                padding: 1rem;
            }

            .settings-section {
                padding: 1rem;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        @keyframes heartBeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.3); }
            28% { transform: scale(1); }
            42% { transform: scale(1.3); }
            70% { transform: scale(1); }
        }

        .floating {
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .bounce {
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: var(--primary-color);
            opacity: 0;
            z-index: 1001;
            animation: confetti 3s ease-in-out forwards;
        }

        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: var(--text-primary);
            color: var(--surface-color);
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: var(--transition-normal);
            font-size: 0.8rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(-5px);
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body data-theme="light">
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">
                    <i class="fas fa-utensils"></i>
                    Smart Meal Planner
                </h1>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="theme-icon"></i>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Planner Screen -->
            <div id="planner-screen" class="screen active">
                <div class="week-container fade-in">
                    <div class="week-header">
                        <h2 id="current-week">Week of <span id="week-date"></span></h2>
                        <div class="week-navigation">
                            <button class="nav-btn" onclick="changeWeek(-1)">
                                <i class="fas fa-chevron-left"></i> Previous
                            </button>
                            <button class="nav-btn" onclick="changeWeek(1)">
                                Next <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="days-grid" id="days-grid">
                        <!-- Days will be populated by JavaScript -->
                    </div>
                    
                    <div class="cost-widget pulse">
                        <h3>Weekly Cost Estimate</h3>
                        <div class="cost-breakdown">
                            <div class="cost-item">
                                <div class="cost-label">Daily Average</div>
                                <div class="cost-value" id="daily-cost">$0.00</div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-label">Weekly Total</div>
                                <div class="cost-value" id="weekly-cost">$0.00</div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-label">Monthly Est.</div>
                                <div class="cost-value" id="monthly-cost">$0.00</div>
                            </div>
                        </div>
                    </div>

                    <div class="shopping-widget" style="background: var(--surface-color); padding: 1.5rem; border-radius: 16px; margin-top: 1.5rem; box-shadow: var(--shadow-md);">
                        <h3>Shopping List Optimization</h3>
                        <div id="seasonal-produce"></div>
                        <div id="bulk-buying-tips" style="margin-top: 1rem;"></div>
                    </div>
                </div>
            </div>

            <!-- Meals Screen -->
            <div id="meals-screen" class="screen">
                <div class="meals-header">
                    <h2>Meal Database</h2>
                </div>
                
                <div class="search-filter-container">
                    <input type="text" class="search-input" placeholder="Search meals..." id="meal-search">
                    <button class="nav-btn" onclick="startVoiceSearch()" style="margin-left: 1rem;">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
                
                <button class="nav-btn" onclick="openFridgeToFork()" style="margin-bottom: 1rem;">
                    <i class="fas fa-ice-cream"></i> Fridge to Fork
                </button>
                
                <div class="filter-tags" id="filter-tags">
                    <!-- Filter tags will be populated by JavaScript -->
                </div>
                
                <div class="meals-grid" id="meals-grid">
                    <!-- Meals will be populated by JavaScript -->
                </div>
            </div>

            <!-- Community Screen -->
            <div id="community-screen" class="screen">
                <h2>Community</h2>
                <div class="community-section" style="background: var(--surface-color); padding: 1.5rem; border-radius: 16px; box-shadow: var(--shadow-md);">
                    <h3>Share Your Recipe</h3>
                    <input type="text" id="recipe-title" class="search-input" placeholder="Recipe Title">
                    <textarea id="recipe-details" style="width: 100%; margin-top: 1rem; padding: 1rem;" placeholder="Enter your recipe details..."></textarea>
                    <button class="nav-btn" onclick="submitRecipe()" style="margin-top: 1rem;">Submit Recipe</button>
                </div>
            </div>

            <!-- Settings Screen -->
            <div id="settings-screen" class="screen">
                <div class="settings-section">
                    <h3 class="settings-title">Preferences</h3>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Currency</div>
                            <div class="setting-description">Choose your preferred currency</div>
                        </div>
                        <div class="setting-control">
                            <select id="currency-select" onchange="updateCurrency()">
                                <option value="USD">US Dollar ($)</option>
                                <option value="EUR">Euro (€)</option>
                                <option value="GBP">British Pound (£)</option>
                                <option value="CAD">Canadian Dollar (C$)</option>
                                <option value="EGP">Egyptian Pound (EGP)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Dietary Preferences</div>
                            <div class="setting-description">Filter meals by dietary needs</div>
                        </div>
                        <div class="setting-control">
                            <select id="diet-select" onchange="updateDietaryPreference()">
                                <option value="">All Diets</option>
                                <option value="Vegan">Vegan</option>
                                <option value="Vegetarian">Vegetarian</option>
                                <option value="High Protein">High Protein</option>
                                <option value="Low Carb">Low Carb</option>
                                <option value="Seyami">Seyami (Fasting-Friendly)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Language</div>
                            <div class="setting-description">Choose your preferred language</div>
                        </div>
                        <div class="setting-control">
                            <select id="language-select" onchange="setLanguage()">
                                <option value="en">English</option>
                                <option value="ar">Arabic</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3 class="settings-title">About</h3>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Version</div>
                            <div class="setting-description">Smart Meal Planner v1.0</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="nav-item active" onclick="switchScreen('planner')">
                <i class="nav-icon fas fa-calendar-alt"></i>
                <span class="nav-label">Planner</span>
            </div>
            <div class="nav-item" onclick="switchScreen('meals')">
                <i class="nav-icon fas fa-utensils"></i>
                <span class="nav-label">Meals</span>
            </div>
            <div class="nav-item" onclick="switchScreen('community')">
                <i class="nav-icon fas fa-users"></i>
                <span class="nav-label">Community</span>
            </div>
            <div class="nav-item" onclick="switchScreen('settings')">
                <i class="nav-icon fas fa-cog"></i>
                <span class="nav-label">Settings</span>
            </div>
        </nav>
    </div>

    <!-- Meal Picker Modal -->
    <div id="meal-picker-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Choose a Meal</h3>
                <button class="close-btn" onclick="closeMealPicker()">×</button>
            </div>
            <div id="meal-picker-content">
                <!-- Meal options will be populated here -->
            </div>
        </div>
    </div>

    <!-- Meal Details Modal -->
    <div id="meal-details-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="meal-details-title">Meal Details</h3>
                <button class="close-btn" onclick="closeMealDetails()">×</button>
            </div>
            <div id="meal-details-content">
                <!-- Meal details will be populated here -->
            </div>
        </div>
    </div>

<script>
    // Global Variables
    let currentWeekOffset = 0;
    let mealPlan = {};
    let selectedMealSlot = null;
    let currentCurrency = 'USD'; // Kept for potential future use
    let currentDietaryPreference = '';
    let favoriteMeals = new Set();
    let activeFilters = new Set();
    let userRecipes = JSON.parse(localStorage.getItem('userRecipes')) || [];
    let mealsDatabase = []; // Initialize as empty, to be populated dynamically

    // Currency symbols (kept for potential future use)
    const currencySymbols = {
        'USD': '$',
        'EUR': '€',
        'GBP': '£',
        'CAD': 'C$',
        'EGP': 'EGP'
    };

    // Language translations
    const translations = {
        en: {
            title: "Smart Meal Planner",
            planner: "Planner",
            meals: "Meals",
            community: "Community",
            settings: "Settings"
        },
        ar: {
            title: "مخطط الوجبات الذكي",
            planner: "المخطط",
            meals: "الوجبات",
            community: "المجتمع",
            settings: "الإعدادات"
        }
    };

    // Common Egyptian ingredients
    const egyptianIngredients = [
        "fava beans", "lentils", "egyptian rice", "okra", "molokhia leaves", "eggplant", 
        "zucchini", "bell peppers", "garlic", "onions", "cumin", "coriander", "dried mint", 
        "cinnamon", "cardamom", "bay leaves", "olive oil", "ghee", "local cheeses", "aish baladi"
    ];

    // Fetch Meals Database
    async function fetchMealsDatabase() {
        try {
            const response = await fetch('https://khalecl.github.io/food-recipe/reciepe.json'); // Use relative path for local file
            if (!response.ok) throw new Error(`Failed to fetch recipes: ${response.statusText}`);
            const data = await response.json();
            
            // Map JSON data to match app's expected structure
            mealsDatabase = data.map((meal, index) => ({
                id: meal.id || index + 1, // Ensure unique ID
                title: meal.title || "Untitled Meal",
                ingredients: (meal.ingredients || []).map(ing => ({
                    name: ing.name || ing.ingredient || "Unknown",
                    quantity: ing.quantity || 1,
                    unit: ing.unit || "",
                    local: egyptianIngredients.includes((ing.name || ing.ingredient || "").toLowerCase())
                })),
                cookingTime: meal.cookingTime || 30,
                cooking_steps: Array.isArray(meal.cooking_steps) ? meal.cooking_steps : 
                              (meal.cooking_steps ? [meal.cooking_steps] : ["No steps provided"]),
                tags: Array.isArray(meal.tags) ? meal.tags : (meal.tags ? [meal.tags] : []),
                type: meal.type || "Main Dish", // Default to "Main Dish" if type is missing
                alternatives: meal.alternatives || {
                    healthier: "No healthier alternative provided",
                    cheaper: "No cheaper alternative provided"
                }
            }));
            
            // Initialize app after fetching data
            initializeApp();
        } catch (error) {
            console.error('Error fetching meals:', error);
            // Fallback to a minimal database
            mealsDatabase = [
                {
                    id: 1,
                    title: "Fallback Koshari",
                    ingredients: [{ name: "Rice", quantity: 200, unit: "g", local: true }],
                    cookingTime: 45,
                    cooking_steps: ["Cook rice and lentils", "Mix with sauce"],
                    tags: ["Vegan", "Egyptian"],
                    type: "Main Dish",
                    alternatives: { healthier: "Use whole grain rice", cheaper: "Use canned lentils" }
                }
            ];
            initializeApp();
        }
    }

    // Initialize App
    function initializeApp() {
        loadSettings();
        loadMealPlan();
        loadFavorites();
        initializeWeekView();
        populateMealsDatabase();
        setupFilterTags();
    }

    document.addEventListener('DOMContentLoaded', fetchMealsDatabase);

    // Theme Management
    function toggleTheme() {
        const body = document.body;
        const themeIcon = document.getElementById('theme-icon');
        
        if (body.getAttribute('data-theme') === 'light') {
            body.setAttribute('data-theme', 'dark');
            themeIcon.className = 'fas fa-sun';
            localStorage.setItem('theme', 'dark');
        } else {
            body.setAttribute('data-theme', 'light');
            themeIcon.className = 'fas fa-moon';
            localStorage.setItem('theme', 'light');
        }
    }

    // Language Management
    function setLanguage() {
        const lang = document.getElementById('language-select').value;
        document.querySelector('.app-title').textContent = translations[lang].title;
        document.querySelectorAll('.nav-label').forEach((label, index) => {
            label.textContent = translations[lang][["planner", "meals", "community", "settings"][index]];
        });
        localStorage.setItem('language', lang);
    }

    // Navigation
    function switchScreen(screenName) {
        document.querySelectorAll('.screen').forEach(screen => {
            screen.classList.remove('active');
        });
        
        document.getElementById(screenName + '-screen').classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
        });
        event.target.closest('.nav-item').classList.add('active');
    }

    // Week Management
    function initializeWeekView() {
        updateWeekDisplay();
        generateDaysGrid();
        updateShoppingWidget();
    }

    function updateWeekDisplay() {
        const today = new Date();
        const weekStart = new Date(today);
        weekStart.setDate(today.getDate() - today.getDay() + 1 + (currentWeekOffset * 7));
        
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekStart.getDate() + 6);
        
        const options = { month: 'short', day: 'numeric' };
        const startStr = weekStart.toLocaleDateString('en-US', options);
        const endStr = weekEnd.toLocaleDateString('en-US', options);
        
        document.getElementById('week-date').textContent = `${startStr} - ${endStr}`;
    }

    function generateDaysGrid() {
        const daysGrid = document.getElementById('days-grid');
        const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
        const mealTypes = ['breakfast', 'lunch', 'dinner'];
        
        daysGrid.innerHTML = '';
        
        daysOfWeek.forEach((day, dayIndex) => {
            const dayCard = document.createElement('div');
            dayCard.className = 'day-card fade-in';
            
            const dayKey = `${currentWeekOffset}-${dayIndex}`;
            
            dayCard.innerHTML = `
                <div class="day-header">${day}</div>
                <div class="meals-container">
                    ${mealTypes.map(mealType => {
                        const mealKey = `${dayKey}-${mealType}`;
                        const meal = mealPlan[mealKey];
                        
                        return `
                            <div class="meal-slot ${meal ? 'filled' : ''}" 
                                 onclick="openMealPicker('${mealKey}', '${mealType}', '${day}')">
                                <div class="meal-type">${mealType.charAt(0).toUpperCase() + mealType.slice(1)}</div>
                                ${meal ? `
                                    <div class="meal-name">${meal.title}</div>
                                    <div class="meal-cost">${meal.type}</div>
                                ` : `
                                    <div class="meal-name">+ Add meal</div>
                                `}
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            daysGrid.appendChild(dayCard);
        });
    }

    function changeWeek(direction) {
        currentWeekOffset += direction;
        updateWeekDisplay();
        generateDaysGrid();
    }

    // Shopping Widget
    function updateShoppingWidget() {
        const seasonalProduce = {
            spring: ["artichokes", "fava beans", "peas"],
            summer: ["tomatoes", "cucumbers", "watermelon"],
            fall: ["eggplant", "peppers", "grapes"],
            winter: ["oranges", "lemons", "cabbage"]
        };
        
        const currentMonth = new Date().getMonth();
        const season = currentMonth < 3 ? "winter" : currentMonth < 6 ? "spring" : 
                       currentMonth < 9 ? "summer" : "fall";
        
        document.getElementById('seasonal-produce').innerHTML = `
            <strong>Seasonal Produce:</strong> ${seasonalProduce[season].join(", ")}
        `;
        
        document.getElementById('bulk-buying-tips').innerHTML = `
            <strong>Bulk Buying Tips:</strong> Buy rice, lentils, and dried beans in larger quantities from local markets for cost savings.
            <br><strong>Spice Shops:</strong> Visit an "Aatar" for fresh cumin, coriander, and custom blends.
        `;
    }

    // Meal Picker
    function openMealPicker(mealKey, mealType, day) {
        selectedMealSlot = { key: mealKey, type: mealType, day: day };
        
        const modal = document.getElementById('meal-picker-modal');
        const content = document.getElementById('meal-picker-content');
        
        let filteredMeals = mealsDatabase.filter(meal => 
            currentDietaryPreference ? meal.tags.includes(currentDietaryPreference) || meal.type === currentDietaryPreference : true
        );
        
        content.innerHTML = `
            <div class="meals-grid">
                ${filteredMeals.map(meal => `
                    <div class="meal-card" onclick="selectMeal(${meal.id})">
                        <div class="meal-card-header">
                            <div class="meal-title">${meal.title}</div>
                            <button class="favorite-btn ${favoriteMeals.has(meal.id) ? 'active' : ''}" 
                                    onclick="event.stopPropagation(); toggleFavorite(${meal.id})">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                        <div class="meal-tags">
                            ${meal.tags.map(tag => `<span class="meal-tag">${tag}</span>`).join('')}
                            <span class="meal-tag">${meal.type}</span>
                        </div>
                        <div class="meal-info">
                            <span><i class="fas fa-clock"></i> ${meal.cookingTime} min</span>
                            <span><i class="fas fa-utensils"></i> ${meal.type}</span>
                        </div>
                        ${meal.tags.includes("Egyptian") ? `
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">
                                Suggested Side: ${mealType === "dinner" ? "Baba Ghanoush" : "Tahini Salad"}
                            </div>
                        ` : ''}
                    </div>
                `).join('')}
            </div>
            ${filteredMeals.length === 0 ? '<p style="text-align: center; color: var(--text-secondary);">No meals found matching your preferences.</p>' : ''}
        `;
        
        modal.classList.add('active');
    }

    function selectMeal(mealId) {
        const meal = mealsDatabase.find(m => m.id === mealId);
        if (meal && selectedMealSlot) {
            mealPlan[selectedMealSlot.key] = meal;
            saveMealPlan();
            generateDaysGrid();
            closeMealPicker();
        }
    }

    function closeMealPicker() {
        document.getElementById('meal-picker-modal').classList.remove('active');
        selectedMealSlot = null;
    }

    // Meal Details
    function showMealDetails(mealId) {
        const meal = mealsDatabase.find(m => m.id === mealId);
        if (!meal) return;
        
        const modal = document.getElementById('meal-details-modal');
        const title = document.getElementById('meal-details-title');
        const content = document.getElementById('meal-details-content');
        
        title.textContent = meal.title;
        
        content.innerHTML = `
            <div class="meal-tags" style="margin-bottom: 1rem;">
                ${meal.tags.map(tag => `<span class="meal-tag">${tag}</span>`).join('')}
                <span class="meal-tag">${meal.type}</span>
            </div>
            
            <div class="meal-info" style="margin-bottom: 1rem;">
                <span><i class="fas fa-clock"></i> ${meal.cookingTime} minutes</span>
                <span><i class="fas fa-utensils"></i> ${meal.type}</span>
            </div>
            
            <div class="meal-ingredients">
                <div class="ingredients-header">Ingredients:</div>
                <div class="ingredients-list">
                    ${meal.ingredients.map(ing => `
                        <div>• ${ing.name} - ${ing.quantity}${ing.unit} ${ing.local ? '<span style="color: green;">(Local)</span>' : ''}</div>
                    `).join('')}
                </div>
            </div>
            
            <div class="cooking-steps">
                <div class="ingredients-header">Cooking Steps:</div>
                <div class="ingredients-list">
                    ${meal.cooking_steps.map((step, index) => `
                        <div>${index + 1}. ${step}</div>
                    `).join('')}
                </div>
            </div>
            
            <div class="alternatives-section">
                <div class="alternatives-title">Alternative Options:</div>
                <div class="alternative-item">
                    <strong>Healthier:</strong> ${meal.alternatives.healthier}
                </div>
                <div class="alternative-item">
                    <strong>Cheaper (Local):</strong> ${meal.alternatives.cheaper}
                </div>
            </div>
        `;
        
        modal.classList.add('active');
    }

    function closeMealDetails() {
        document.getElementById('meal-details-modal').classList.remove('active');
    }

    // Meals Database Screen
    function populateMealsDatabase() {
        const mealsGrid = document.getElementById('meals-grid');
        renderMeals(mealsDatabase);
    }

    function renderMeals(meals) {
        const mealsGrid = document.getElementById('meals-grid');
        
        mealsGrid.innerHTML = meals.map(meal => `
            <div class="meal-card" onclick="showMealDetails(${meal.id})">
                <div class="meal-card-header">
                    <div class="meal-title">${meal.title}</div>
                    <button class="favorite-btn ${favoriteMeals.has(meal.id) ? 'active' : ''}" 
                            onclick="event.stopPropagation(); toggleFavorite(${meal.id})">
                        <i class="fas fa-heart"></i>
                    </button>
                </div>
                <div class="meal-tags">
                    ${meal.tags.map(tag => `<span class="meal-tag">${tag}</span>`).join('')}
                    <span class="meal-tag">${meal.type}</span>
                </div>
                <div class="meal-info">
                    <span><i class="fas fa-clock"></i> ${meal.cookingTime} min</span>
                    <span><i class="fas fa-utensils"></i> ${meal.type}</span>
                </div>
                <div class="meal-ingredients">
                    <div class="ingredients-header">Ingredients:</div>
                    <div class="ingredients-list">
                        ${meal.ingredients.slice(0, 3).map(ing => 
                            `${ing.name} (${ing.quantity}${ing.unit})`
                        ).join(', ')}${meal.ingredients.length > 3 ? '...' : ''}
                    </div>
                </div>
            </div>
        `).join('');
    }

    // Search and Filter
    function setupFilterTags() {
        const filterTags = document.getElementById('filter-tags');
        const allTags = [...new Set(mealsDatabase.flatMap(meal => meal.tags))];
        const allTypes = [...new Set(mealsDatabase.map(meal => meal.type))];
        const egyptianFilters = ["Egyptian", "Seyami", "Ramadan", "Eid", "Breakfast", "Street Food", "Batch Cooking"];
        const combinedTags = [...new Set([...egyptianFilters, ...allTags, ...allTypes])];
        
        filterTags.innerHTML = combinedTags.map(tag => `
            <span class="filter-tag" onclick="toggleFilter('${tag}')">${tag}</span>
        `).join('');
        
        document.getElementById('meal-search').addEventListener('input', filterMeals);
    }

    function toggleFilter(tag) {
        const filterElement = event.target;
        
        if (activeFilters.has(tag)) {
            activeFilters.delete(tag);
            filterElement.classList.remove('active');
        } else {
            activeFilters.add(tag);
            filterElement.classList.add('active');
        }
        
        filterMeals();
    }

    function filterMeals() {
        const searchTerm = document.getElementById('meal-search').value.toLowerCase();
        
        let filteredMeals = mealsDatabase.filter(meal => {
            const matchesSearch = meal.title.toLowerCase().includes(searchTerm) ||
                                 meal.ingredients.some(ing => ing.name.toLowerCase().includes(searchTerm));
            
            const matchesFilters = activeFilters.size === 0 || 
                                  [...activeFilters].every(filter => 
                                      meal.tags.includes(filter) || meal.type === filter
                                  );
            
            return matchesSearch && matchesFilters;
        });
        
        renderMeals(filteredMeals);
    }

    // Voice Search
    function startVoiceSearch() {
        if ('webkitSpeechRecognition' in window) {
            const recognition = new webkitSpeechRecognition();
            recognition.lang = document.getElementById('language-select').value === 'ar' ? 'ar-EG' : 'en-US';
            recognition.onresult = (event) => {
                document.getElementById('meal-search').value = event.results[0][0].transcript;
                filterMeals();
            };
            recognition.start();
        } else {
            alert('Voice search is not supported in your browser.');
        }
    }

    // Fridge to Fork
    function openFridgeToFork() {
        const modal = document.getElementById('meal-picker-modal');
        const content = document.getElementById('meal-picker-content');
        
        content.innerHTML = `
            <input type="text" id="fridge-input" class="search-input" placeholder="Enter ingredients (e.g., fava beans, garlic)">
            <button class="nav-btn" onclick="suggestRecipesFromFridge()" style="margin-top: 1rem;">Find Recipes</button>
            <div id="fridge-results" class="meals-grid" style="margin-top: 1rem;"></div>
        `;
        
        modal.classList.add('active');
    }

    function suggestRecipesFromFridge() {
        const input = document.getElementById('fridge-input').value.toLowerCase().split(',').map(i => i.trim());
        const results = mealsDatabase.filter(meal => 
            meal.ingredients.some(ing => input.includes(ing.name.toLowerCase()))
        );
        
        document.getElementById('fridge-results').innerHTML = results.map(meal => `
            <div class="meal-card" onclick="showMealDetails(${meal.id})">
                <div class="meal-title">${meal.title}</div>
                <div class="meal-info">
                    <span><i class="fas fa-clock"></i> ${meal.cookingTime} min</span>
                </div>
            </div>
        `).join('') || '<p>No matching recipes found.</p>';
    }

    // Community Recipes
    function submitRecipe() {
        const title = document.getElementById('recipe-title').value;
        const details = document.getElementById('recipe-details').value;
        if (title && details) {
            userRecipes.push({ title, details, id: Date.now() });
            localStorage.setItem('userRecipes', JSON.stringify(userRecipes));
            alert('Recipe submitted successfully!');
            document.getElementById('recipe-title').value = '';
            document.getElementById('recipe-details').value = '';
        }
    }

    // Favorites
    function toggleFavorite(mealId) {
        const btn = event.target.closest('.favorite-btn');
        
        if (favoriteMeals.has(mealId)) {
            favoriteMeals.delete(mealId);
            btn.classList.remove('active');
        } else {
            favoriteMeals.add(mealId);
            btn.classList.add('active');
        }
        
        saveFavorites();
    }

    // Local Storage Functions
    function saveMealPlan() {
        try {
            const mealPlanData = {};
            for (const [key, meal] of Object.entries(mealPlan)) {
                mealPlanData[key] = { id: meal.id };
            }
            localStorage.setItem('mealPlan', JSON.stringify(mealPlanData));
        } catch (e) {
            console.warn('Could not save meal plan:', e);
        }
    }

    function loadMealPlan() {
        try {
            const saved = localStorage.getItem('mealPlan');
            if (saved) {
                const mealPlanData = JSON.parse(saved);
                mealPlan = {};
                
                for (const [key, mealRef] of Object.entries(mealPlanData)) {
                    const meal = mealsDatabase.find(m => m.id === mealRef.id);
                    if (meal) {
                        mealPlan[key] = meal;
                    }
                }
            }
        } catch (e) {
            console.warn('Could not load meal plan:', e);
            mealPlan = {};
        }
    }

    function saveSettings() {
        try {
            const settings = {
                currency: currentCurrency,
                dietaryPreference: currentDietaryPreference,
                language: document.getElementById('language-select').value
            };
            localStorage.setItem('settings', JSON.stringify(settings));
        } catch (e) {
            console.warn('Could not save settings:', e);
        }
    }

    function loadSettings() {
        try {
            const saved = localStorage.getItem('settings');
            if (saved) {
                const settings = JSON.parse(saved);
                currentCurrency = settings.currency || 'USD';
                currentDietaryPreference = settings.dietaryPreference || '';
                document.getElementById('currency-select').value = currentCurrency;
                document.getElementById('diet-select').value = currentDietaryPreference;
                document.getElementById('language-select').value = settings.language || 'en';
                setLanguage();
            }
            
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            document.getElementById('theme-icon').className = 
                savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        } catch (e) {
            console.warn('Could not load settings:', e);
        }
    }

    function saveFavorites() {
        try {
            localStorage.setItem('favorites', JSON.stringify([...favoriteMeals]));
        } catch (e) {
            console.warn('Could not save favorites:', e);
        }
    }

    function loadFavorites() {
        try {
            const saved = localStorage.getItem('favorites');
            if (saved) {
                favoriteMeals = new Set(JSON.parse(saved));
            }
        } catch (e) {
            console.warn('Could not load favorites:', e);
            favoriteMeals = new Set();
        }
    }

    // Close modals when clicking outside
    window.onclick = function(event) {
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            if (event.target === modal) {
                modal.classList.remove('active');
            }
        });
    }

    // Keyboard navigation
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            document.querySelectorAll('.modal.active').forEach(modal => {
                modal.classList.remove('active');
            });
        }
    });

    // Service Worker Registration
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('/sw.js').then(function(registration) {
                console.log('ServiceWorker registration successful');
            }, function(err) {
                console.log('ServiceWorker registration failed');
            });
        });
    }
</script>
</body>
</html>
